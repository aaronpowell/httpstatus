name: Build and Deploy to staging

on:
  pull_request:
    branches: [main]

env:
  AZURE_WEBAPP_NAME: httpstatus-preview
  IMAGE_NAME: ${{ github.repository }}-staging

permissions:
  id-token: write
  contents: read

jobs:
  build:
    uses: ./.github/workflows/build.yml
    secrets: inherit
    with:
      image_name: ${{ env.IMAGE_NAME }}

  deploy:
    uses: ./.github/workflows/deploy.yml
    secrets: inherit
    with:
      image_name: ${{ env.IMAGE_NAME }}
      azure_webapp_name: ${{ env.AZURE_WEBAPP_NAME }}
