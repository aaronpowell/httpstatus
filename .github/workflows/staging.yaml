name: Build and Deploy to staging

on:
  pull_request:
    branches: [main]

env:
  AZURE_WEBAPP_NAME: httpstatus-preview
  IMAGE_NAME: ${{ github.repository }}-staging

permissions:
  id-token: write
  contents: read

jobs:
  build:
    uses: ./.github/workflows/build.yaml
    secrets: inherit
    with:
      image_name: ${{ github.repository }}-staging

  deploy:
    uses: ./.github/workflows/deploy.yaml
    secrets: inherit
    with:
      image_name: ${{ github.repository }}-staging
      azure_webapp_name: httpstatus-preview
